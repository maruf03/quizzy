{% extends 'base.html' %}
{% load ui %}
{% block content %}
<h2 class="h5 mb-3">{% if question %}Edit Question{% else %}New Question{% endif %} â€“ <span class="text-body-secondary">{{ quiz.title }}</span></h2>
<form method="post" novalidate>
  {% csrf_token %}
  <div class="mb-3">
    <label for="id_text" class="form-label">Question Text</label>
    {{ form.text|add_class:"form-control" }}
  </div>
  <h3 class="h6 mb-2">Answers</h3>
  {{ formset.management_form }}
    <div class="mb-2 small text-body-secondary">At least two answers, and mark one correct.</div>
    <div id="answer-empty" class="d-none">
      {% with empty=formset.empty_form %}
      <div class="card mb-2 formset-item" data-index="__prefix__">
        <div class="card-body p-3">
          {{ empty.id }}
          <div class="row g-2 align-items-center">
            <div class="col-md-9">
              <label class="form-label small" for="{{ empty.text.id_for_label }}">Text</label>
              {{ empty.text|add_class:"form-control" }}
            </div>
            <div class="col-md-2">
              <div class="form-check mt-4">
                {{ empty.is_correct|add_class:"form-check-input" }}
                <label class="form-check-label small" for="{{ empty.is_correct.id_for_label }}">Correct</label>
              </div>
            </div>
            <div class="col-md-1 d-flex justify-content-end">
              <button type="button" class="btn btn-sm btn-outline-danger mt-4 remove-row" aria-label="Remove answer">&times;</button>
            </div>
          </div>
          <div class="d-none delete-field">{{ empty.DELETE }}</div>
        </div>
      </div>
      {% endwith %}
    </div>
  <div data-formset="answers" data-prefix="{{ formset.prefix }}" class="answer-formset-container">
      {% for aform in formset.forms %}
        <div class="card mb-2 formset-item" data-index="{{ forloop.counter0 }}">
          <div class="card-body p-3">
            {{ aform.id }}
            <div class="row g-2 align-items-center">
              <div class="col-md-9">
                <label class="form-label small" for="{{ aform.text.id_for_label }}">Text</label>
                {{ aform.text|add_class:"form-control" }}
              </div>
              <div class="col-md-2">
                <div class="form-check mt-4">
                  {{ aform.is_correct|add_class:"form-check-input" }}
                  <label class="form-check-label small" for="{{ aform.is_correct.id_for_label }}">Correct</label>
                </div>
              </div>
              <div class="col-md-1 d-flex justify-content-end">
                <button type="button" class="btn btn-sm btn-outline-danger mt-4 remove-row" {% if forloop.first and forloop.last %}disabled{% endif %}>&times;</button>
              </div>
            </div>
            {% if aform.DELETE %}
              <div class="d-none delete-field">{{ aform.DELETE }}</div>
            {% endif %}
            {% if aform.errors %}
              <div class="invalid-feedback d-block small mt-1">{{ aform.errors }}</div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    <div class="mb-3"><button type="button" class="btn btn-sm btn-outline-primary" id="add-answer">Add answer</button></div>
  {% if formset.non_form_errors %}
    <div class="mt-2 text-danger small">{{ formset.non_form_errors }}</div>
  {% endif %}
  <div>
    <button class="btn btn-primary">Save</button>
    <a href="{% url 'quizzes:questions' quiz.id %}" class="btn btn-outline-secondary ms-2">Back</a>
  </div>
</form>
{% endblock %}
